/*! iptools-jquery-genericfilter - v0.0.2 - 2015-07-30
* https://github.com/interactive-pioneers/iptools-jquery-genericfilter
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL */
!function(a){"use strict";function b(b,c){this.settings=a.extend({},o,c),this.$form=a(b),this._$lastTrigger=null,m(this),l(this)}function c(b){var c=b.data(q),d=c.replace(/([A-Za-z]+[\w\-\:\.]*)/g,"#$&");return a(d)}function d(b,c){var d=a.trim(c.val()),e=g(b,c),f=h(b,c,!1),i=j(f);return"0"===d||""===d||e&&!i?null:d}function e(b,d){var e=!1,f=c(b);return null===d?e:(f.each(function(){d.attr("id")===a(this).attr("id")&&(e=!0)}),e)}function f(b){var e=b.data,f=a(b.target),h=f.closest(e.settings.filterSelector),j=c(h),k=d(e,f);return e.clearDependencyChain(h,null===k),g(e,f)&&i(e,f),e.updateResult(),null===k||0===j.length&&!e.settings.noDependencyFilterTrigger?!1:void 0}function g(a,b){var c=h(a,b,!0);return c.length>0}function h(a,b,c){var d=b.closest(a.settings.filterSelector),e=d.find('input[type="checkbox"]').not(c?b:"");return e}function i(b,c){var d=h(b,c,!0),e=c.data("params");d.each(function(){a(this).is(":checked")&&(e+="&"+encodeURIComponent(a(this).attr("name"))+"=on")}),c.data("params",e)}function j(b){var c=!1;return b.each(function(){a(this).is(":checked")&&(c=!0)}),c}function k(a){return a+"."+n}function l(a){a.$form.on(k("ajax:before"),p,a,f)}function m(b){b.$form.find(b.settings.filterSelector).each(function(){if("undefined"==typeof a(this).data(q))throw new Error("Required data attribute genericfilter-dependencies missing for "+a(this).attr("id"))})}var n="iptGenericFilter",o={noDependencyFilterTrigger:!1,filterSelector:".genericfilter__filter"},p="input, select, textarea",q="genericfilter-dependencies";b.prototype.clearDependencyChain=function(a,b){var d=c(a),f=e(a,this._$lastTrigger);return 0===d.length||f?void(this._$lastTrigger=null):(this.clearFilter(d,b),this._$lastTrigger=a,void this.clearDependencyChain(d,!0))},b.prototype.clearFilter=function(a,b){a.find(p).val(null),b&&a.empty()},b.prototype.updateResult=function(){console.log("updateResult"),this.$form.submit()},b.prototype.destroy=function(){this.$form.off(n),this.$form.removeData("plugin_"+n)},a.fn[n]=function(c){return this.each(function(){a.data(this,"plugin_"+n)||a.data(this,"plugin_"+n,new b(this,c))})}}(jQuery);