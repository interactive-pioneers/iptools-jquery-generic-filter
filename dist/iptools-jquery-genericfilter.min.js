/*! iptools-jquery-genericfilter - v0.0.1 - 2015-07-27
* https://github.com/interactive-pioneers/iptools-jquery-genericfilter
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL */
!function(a){"use strict";function b(b,c){this.settings=a.extend({},o,c),this.$form=a(b),this._$lastTrigger=null,m(this.$form),l(this)}function c(b){a.each(b,function(b,c){a("#"+c.selector).html(c.template)})}function d(b,c){var d=!1,f=e(b);return null===c?d:(f.each(function(){c.attr("id")===a(this).attr("id")&&(d=!0)}),d)}function e(b){var c=b.data(r),d=c.replace(/([A-Za-z]+[\w\-\:\.]*)/g,"#$&");return a(d)}function f(a){var b=h(a,!0);return b.length>0}function g(b){var c=h(b,!0),d=b.data("params");c.each(function(){a(this).is(":checked")&&(d+="&"+encodeURIComponent(a(this).attr("name"))+"=on")}),b.data("params",d)}function h(a,b){var c=a.closest(q),d=c.find('input[type="checkbox"]').not(b?a:"");return d}function i(b){var c=b.data,d=a(b.target),h=d.closest(q),i=e(h);return 0!==i.length||c.settings.noDependencyFilterTrigger?void(f(d)&&g(d)):(c.updateResult(),!1)}function j(b,c){var d=b.data,e=a(b.target).closest(q),f=null;try{f=a.parseJSON(c.responseText)}catch(g){"object"==typeof console&&"function"==typeof console.log&&(console.log(c),console.log(g)),f=null}finally{d.updateFilterDependencies(e,f)}}function k(a){return a+"."+n}function l(a){a.$form.on(k("ajax:before"),p,a,i),a.$form.on(k("ajax:complete"),p,a,j)}function m(b){b.find(q).each(function(){if("undefined"==typeof a(this).data(r))throw new Error("Required data attribute genericfilter-dependencies missing for "+a(this).attr("id"))})}var n="iptGenericFilter",o={noDependencyFilterTrigger:!1},p="input, select, textarea",q=".genericfilter__filter",r="genericfilter-dependencies";b.prototype.updateFilterDependencies=function(a,b){var f=e(a),g=d(a,this._$lastTrigger);return 0===f.length||g?(this.updateResult(),void(this._$lastTrigger=null)):(null!==b?c(b):this.clearFilter(f),this._$lastTrigger=a,void this.updateFilterDependencies(f,null))},b.prototype.clearFilter=function(a){a.find(p).val(null),a.empty()},b.prototype.updateResult=function(){this.$form.submit()},b.prototype.destroy=function(){this.$form.off(n),this.$form.removeData("plugin_"+n)},a.fn[n]=function(c){return this.each(function(){a.data(this,"plugin_"+n)||a.data(this,"plugin_"+n,new b(this,c))})}}(jQuery);