/*! iptools-jquery-genericfilter - v0.0.1 - 2015-07-23
* https://github.com/interactive-pioneers/iptools-jquery-genericfilter
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL */
!function(a){"use strict";function b(b,c){this.settings=a.extend({},i,c),this.$form=a(b),this._$lastTrigger=null,g(this)}function c(b,c){var d=!1,e="#"+b.attr("id"),f=c.data("genericfilter-dependencies"),g=f.split(",");return a.each(g,function(b,c){e===a.trim(c)&&(d=!0)}),d}function d(b){var c=b.data,d=a(b.target),e=d.closest(".genericfilter__filter"),f=encodeURIComponent(a.trim(e.data("genericfilter-dependencies")));return""===f?(c.updateResult(),!1):(d.data("url",c.settings.basePath+"filter"),void d.data("params","dependencies="+f))}function e(b,c){var d=b.data,e=a(b.target).closest(".genericfilter__filter"),f=""!==a.trim(c.responseText)?a.parseJSON(a.trim(c.responseText).replace(/\r?\n|\r/g,"")):null;d.updateFilterDependencies(e,f)}function f(a){return a+"."+h}function g(a){a.$form.on(f("ajax:before"),j,a,d),a.$form.on(f("ajax:complete"),j,a,e)}var h="iptGenericFilter",i={basePath:""},j="input, select, textarea";b.prototype.clearFilter=function(a){a.find(j).val(null),a.empty()},b.prototype.getFilterDependencies=function(b){var c=b.data("genericfilter-dependencies"),d=a(c.toString());return 0===c.length||0===d.length?null:d},b.prototype.updateFilterDependencies=function(b,d){var e=this.getFilterDependencies(b);return null===e?void this.updateResult():null!==this._$lastTrigger&&c(this._$lastTrigger,b)?(this.updateResult(),void(this._$lastTrigger=null)):(null!==d?a.each(d,function(b,c){a(b).html(c)}):this.clearFilter(e),this._$lastTrigger=b,void this.updateFilterDependencies(e,null))},b.prototype.updateResult=function(){this.$form.submit()},b.prototype.destroy=function(){this.$form.off(h),this.$form.removeData("plugin_"+h)},a.fn[h]=function(c){return this.each(function(){a.data(this,"plugin_"+h)||a.data(this,"plugin_"+h,new b(this,c))})}}(jQuery);