/*! iptools-jquery-genericfilter - v0.0.5 - 2015-08-29
* https://github.com/interactive-pioneers/iptools-jquery-genericfilter
* Copyright Â© 2015 Interactive Pioneers GmbH; Licensed GPL */
!function(a){"use strict";function b(b,c){this.settings=a.extend({},v,c),this.$form=a(b),this._$lastTrigger=null,t(this),q(this)}function c(b){var c=b.data(y),d=c.replace(/([A-Za-z]+[\w\-\:\.]*)/g,"#$&");return a(d)}function d(b,c){var d=a.trim(c.val()),e=i(b,c),f=j(b,c,!1),g=l(f);return"0"===d||""===d||e&&!g?null:d}function e(b,d){var e=!1,f=c(b);return null===d?e:(f.each(function(){d.attr("id")===a(this).attr("id")&&(e=!0)}),e)}function f(b){var e=b.data,f=a(b.target),g=f.closest(e.settings.filterSelector),h=c(g),j=d(e,f),l=null===j,m=0===h.length&&!e.settings.noDependencyFilterTrigger,o=l||m;return e.clearDependencyChain(g,null===j),i(e,f)&&k(e,f),o&&r(e),e.updateResult(),n(e),o?!1:void 0}function g(a){var b=a.data;h(a),s(b)}function h(a){var b=a.data;o(b)}function i(a,b){var c=j(a,b,!0);return c.length>0}function j(a,b,c){var d=b.closest(a.settings.filterSelector),e=d.find('input[type="checkbox"]').not(c?b:"");return e}function k(b,c){var d=j(b,c,!0),e=c.data("params");d.each(function(){a(this).is(":checked")&&(e+="&"+encodeURIComponent(a(this).attr("name"))+"=on")}),c.data("params",e)}function l(b){var c=!1;return b.each(function(){a(this).is(":checked")&&(c=!0)}),c}function m(a){var b=a.data;return"undefined"==typeof b.$form.find(x).attr("disabled")&&b.$form.find('input[data-remote="true"]').last().trigger("change"),a.preventDefault(),!1}function n(a){a.$form.find(w).attr("disabled","disabled")}function o(a){a.$form.find(w).removeAttr("disabled")}function p(a,b){var c=b||"";return a+"."+u+c}function q(a){a.$form.on(p("ajax:beforeSend"),w,a,f).on(p("ajax:complete"),w,a,h).on(p("click"),x,a,m)}function r(a){a.$form.on(p("ajax:complete","temp"),a,g)}function s(a){a.$form.off(p("ajax:complete","temp"))}function t(b){b.$form.find(b.settings.filterSelector).each(function(){if("undefined"==typeof a(this).data(y))throw new Error("Required data attribute genericfilter-dependencies missing for "+a(this).attr("id"))})}var u="iptGenericFilter",v={noDependencyFilterTrigger:!1,filterSelector:".genericfilter__filter"},w='input, select, textarea, button[type="submit"]',x='button[type="submit"], input[type="submit"]',y="genericfilter-dependencies";b.prototype.clearDependencyChain=function(a,b){var d=c(a),f=e(a,this._$lastTrigger);return 0===d.length||f?void(this._$lastTrigger=null):(this.clearFilter(d,b),this._$lastTrigger=a,void this.clearDependencyChain(d,!0))},b.prototype.clearFilter=function(a,b){a.find(w).val(null),b&&a.empty()},b.prototype.updateResult=function(){this.$form.submit()},b.prototype.destroy=function(){this.$form.off(u),this.$form.removeData("plugin_"+u)},a.fn[u]=function(c){return this.each(function(){a.data(this,"plugin_"+u)||a.data(this,"plugin_"+u,new b(this,c))})}}(jQuery);